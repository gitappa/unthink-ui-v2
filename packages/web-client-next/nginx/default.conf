# Expires map
map $sent_http_content_type $expires {
    default                    off;
    text/html                  epoch;
    text/css                   max;
    application/javascript     max;
    ~image/                    max;
    ~font/                     max;
}

server {
    listen 3000 default_server;
    listen [::]:3000 default_server ipv6only=on;
    server_name localhost;
    root /usr/share/nginx/html;
    absolute_redirect off;
    port_in_redirect off;
    expires $expires;
    
    location /blog/ { # you can use different slugs instead of /blog/ ex: content, knowledge, learn
        rewrite ^([^.]*[^/])$ $1/ permanent; 
        sub_filter_once off;
        sub_filter_types *;
        sub_filter /_elderjs /blog/_elderjs;
        proxy_ssl_verify off;
        proxy_set_header Host "unthink.superblog.cloud";
        proxy_set_header X-Forwarded-Host "";
        proxy_set_header X-Forwarded-For "";
        proxy_set_header Accept-Encoding "";
        proxy_set_header Cookie "";
        proxy_ssl_server_name on;
        proxy_pass https://unthink.superblog.cloud/;
        proxy_redirect ~^(http://[^/]+)(/.*)$ https://$http_host$2;
    }

    location / {
        rewrite ^([^.]*[^/])$ $1/ permanent; 
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # location / {
    #     add_header Cache-Control "public";
    #     proxy_pass http://localhost:9000;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Forwarded-For $remote_addr;
    #     proxy_intercept_errors on;
    #     recursive_error_pages on;
    # }

    error_page 404 /404.html;
    location = /404.html {
        root /usr/share/nginx/html;
        internal;
    }
    
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
        internal;
    }
    
    gzip on;
    gzip_vary on;
    gzip_min_length 10240;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml;
    gzip_disable "MSIE [1-6]\.";
}
